const { constants } = require('@openzeppelin/test-helpers');
const { expect } = require('chai');
const { BigNumber } = require('ethers');

const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000';
const MAX_UINT256 = BigNumber.from('115792089237316195423570985008687907853269984665640564039457584007913129639935');

describe('RationalNumbers', function () {
    var initialHolder;
    var recipient;
    var anotherAccount;
    var token;

    /*
    alpha_1: (4503322228978077916651710446042370109107355802721800704639343137502100212473, 6132642251294427119375180147349983541569387941788025780665104001559216576968)
    beta_2: ((10191129150170504690859455063377241352678147020731325090942140630855943625622, 12345624066896925082600651626583520268054356403303305150512393106955803260718), (16727484375212017249697795760885267597317766655549468217180521378213906474374, 13790151551682513054696583104432356791070435696840691503641536676885931241944))
    gamma_2: ((10857046999023057135944570762232829481370756359578518086990519993285655852781, 11559732032986387107991004021392285783925812861821192530917403151452391805634), (8495653923123431417604973247489272438418190587263600148770280649306958101930, 4082367875863433681332203403145435568316851327593401208105741076214120093531))
    delta_2: ((10191129150170504690859455063377241352678147020731325090942140630855943625622, 12345624066896925082600651626583520268054356403303305150512393106955803260718), (16727484375212017249697795760885267597317766655549468217180521378213906474374, 13790151551682513054696583104432356791070435696840691503641536676885931241944))
    */
    beforeEach(async function () {
        [initialHolder, recipient, anotherAccount] = await ethers.getSigners();
        var alpha_1 = {
            x: BigNumber.from('4503322228978077916651710446042370109107355802721800704639343137502100212473'),
            y: BigNumber.from('6132642251294427119375180147349983541569387941788025780665104001559216576968')
        };
        var beta_2 = {
            x: [BigNumber.from('10191129150170504690859455063377241352678147020731325090942140630855943625622'),
            BigNumber.from('12345624066896925082600651626583520268054356403303305150512393106955803260718')],
            y: [BigNumber.from('16727484375212017249697795760885267597317766655549468217180521378213906474374'),
            BigNumber.from('13790151551682513054696583104432356791070435696840691503641536676885931241944')]
        };
        var gamma_2 = {
            x: [BigNumber.from('10857046999023057135944570762232829481370756359578518086990519993285655852781'),
            BigNumber.from('11559732032986387107991004021392285783925812861821192530917403151452391805634')],
            y: [BigNumber.from('8495653923123431417604973247489272438418190587263600148770280649306958101930'),
            BigNumber.from('4082367875863433681332203403145435568316851327593401208105741076214120093531')]
        };
        var delta_2 = {
            x: [BigNumber.from('10191129150170504690859455063377241352678147020731325090942140630855943625622'),
            BigNumber.from('12345624066896925082600651626583520268054356403303305150512393106955803260718')],
            y: [BigNumber.from('16727484375212017249697795760885267597317766655549468217180521378213906474374'),
            BigNumber.from('13790151551682513054696583104432356791070435696840691503641536676885931241944')]
        }

        const RationalNumbers = await ethers.getContractFactory("RationalNumbers");
        token = await RationalNumbers.deploy(alpha_1, beta_2, gamma_2, delta_2);
    });

    describe('Call checkPairings', function () {
        /*
        A_1: (4503322228978077916651710446042370109107355802721800704639343137502100212473, 6132642251294427119375180147349983541569387941788025780665104001559216576968)
        B_2: (
            (10191129150170504690859455063377241352678147020731325090942140630855943625622, 
                12345624066896925082600651626583520268054356403303305150512393106955803260718), 
            (16727484375212017249697795760885267597317766655549468217180521378213906474374, 
                13790151551682513054696583104432356791070435696840691503641536676885931241944))
        C_1: (1, 21888242871839275222246405745257275088696311157297823662689037894645226208581)
        */

        it('works correctly for positive case', async function () {
            var a_1 = {
                x: BigNumber.from('4503322228978077916651710446042370109107355802721800704639343137502100212473'),
                y: BigNumber.from('6132642251294427119375180147349983541569387941788025780665104001559216576968')
            };

            var b_2 = {
                x: [BigNumber.from('10191129150170504690859455063377241352678147020731325090942140630855943625622'),
                BigNumber.from('12345624066896925082600651626583520268054356403303305150512393106955803260718')],
                y: [BigNumber.from('16727484375212017249697795760885267597317766655549468217180521378213906474374'),
                BigNumber.from('13790151551682513054696583104432356791070435696840691503641536676885931241944')]
            };

            c_1 = {
                x: BigNumber.from('1'),
                y: BigNumber.from('21888242871839275222246405745257275088696311157297823662689037894645226208581')
            };

            expect(await token.checkPairings(
                a_1,
                b_2,
                c_1,
                BigNumber.from('1'),
                BigNumber.from('2'),
                BigNumber.from('3'))).to.be.true;
        });

        it('works correctly for negative case', async function () {
            var a_1 = {
                x: BigNumber.from('4503322228978077916651710446042370109107355802721800704639343137502100212473'),
                y: BigNumber.from('6132642251294427119375180147349983541569387941788025780665104001559216576968')
            };

            var b_2 = {
                x: [BigNumber.from('10191129150170504690859455063377241352678147020731325090942140630855943625622'),
                BigNumber.from('12345624066896925082600651626583520268054356403303305150512393106955803260718')],
                y: [BigNumber.from('16727484375212017249697795760885267597317766655549468217180521378213906474374'),
                BigNumber.from('13790151551682513054696583104432356791070435696840691503641536676885931241944')]
            };

            c_1 = {
                x: BigNumber.from('1'),
                y: BigNumber.from('21888242871839275222246405745257275088696311157297823662689037894645226208581')
            };

            expect(await token.checkPairings(
                a_1,
                b_2,
                c_1,
                BigNumber.from('3'),
                BigNumber.from('3'),
                BigNumber.from('3'))).to.be.revertedWith('Wrong pairing');
        });
    });
});
